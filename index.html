<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Comparador de Cr√©ditos ICETEX</title>
  <link rel="stylesheet" href="comparador_styles.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet" />
</head>
<body>
  <div class="sidebar">
    <h1 class="titulo-simulado">COMPARADOR<br>DE CR√âDITOS<br>ICETEX</h1>

    <form class="formulario" onsubmit="mostrarComparacion(); return false;">
      <label for="nivelFormacion">Nivel de formaci√≥n</label>
      <select id="nivelFormacion" onchange="filtrarLineasPorNivel()">
        <option value="">Seleccione una opci√≥n</option>
        <option value="Pregrado">Pregrado</option>
        <option value="Posgrado pa√≠s">Posgrado pa√≠s</option>
        <option value="Posgrado medicina">Posgrado medicina</option>
        <option value="ETDH">ETDH</option>
        <option value="Posgrado exterior">Posgrado exterior</option>
        <option value="Idiomas pa√≠s">Idiomas en el pa√≠s</option>
        <option value="Sostenimiento">Sostenimiento</option>
      </select>

      <label for="valorPeriodo">¬øCu√°l es el valor de tu periodo acad√©mico?</label>
      <input type="text" id="valorPeriodo" placeholder="Ingresa el valor de tu periodo acad√©mico" oninput="formatearCOPInput(this)" />

      <label for="numPeriodos">¬øCu√°ntos periodos acad√©micos necesitas financiar?</label>
      <select id="numPeriodos">
        <option value="">Selecciona el n√∫mero de periodos</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
        <option value="6">6</option>
        <option value="7">7</option>
        <option value="8">8</option>
        <option value="9">9</option>
        <option value="10">10</option>
        <option value="11">11</option>
        <option value="12">12</option>
      </select>

      <label for="periodicidad">¬øCu√°l es la periodicidad de tu programa acad√©mico?</label>
      <select id="periodicidad">
        <option value="">Selecciona la periodicidad</option>
        <option value="mensual">Mensual</option>
        <option value="bimestral">Bimestral</option>
        <option value="trimestral">Trimestral</option>
        <option value="cuatrimestral">Cuatrimestral</option>
        <option value="semestral">Semestral</option>
        <option value="anual">Anual</option>
      </select>

      <button type="submit">Ver comparador</button>
    </form>

    <!-- Decoraciones -->
    <img class="decorador decorador-top-left" src="img/circunferencias_Mesa de trabajo 1.png" />
    <img class="decorador decorador-bottom-left" src="img/circunferencias_Mesa de trabajo 1.png" />
  </div>

  <div class="main">
    <div class="ilustracion-superior">
      <img src="img/ilustracion_1.png" alt="Ilustraci√≥n comparador ICETEX" />
    </div>
    <div class="card-grid" id="resumenComparador"></div>
  </div>

  <img class="decorador decorador-top-right-ajustada" src="img/circunferencias_Mesa de trabajo 1.png" />
  <img class="decorador decorador-bottom-right-ajustada" src="img/circunferencias_Mesa de trabajo 1.png" />

  <script>
    const lineasPorNivel = {
      "Pregrado": ["Plan flexible", "Plan equilibrio", "Plan √°gil"],
      "Posgrado pa√≠s": ["Plan posgrado en el pa√≠s"],
      "Posgrado medicina": ["Plan posgrado para medicina en Colombia"],
      "ETDH": ["Plan para Educaci√≥n para el Trabajo"],
      "Posgrado exterior": ["Plan posgrado para fuera de Colombia"],
      "Idiomas pa√≠s": ["Plan segundo idioma"],
      "Sostenimiento": ["Plan para Bienestar fuera de Colombia","Plan saber m√°s"]
    };

    const condicionesLineaCredito = {
      "Plan flexible": 0.3,
      "Plan equilibrio": 0.6,
      "Plan √°gil": 1.0,
      "Plan posgrado para medicina en Colombia": 0.2,
      "Plan para Educaci√≥n para el Trabajo": 0.3,
      "Plan posgrado en el pa√≠s": 0.4,
      "Plan posgrado para fuera de Colombia": 0,
      "Plan segundo idioma": 0,
      "Plan para Bienestar fuera de Colombia": 0,
      "Plan saber m√°s": 0,
    };

    const spreadPorLinea = {
      "Plan flexible": 0.09,
      "Plan equilibrio": 0.07,
      "Plan √°gil": 0.07,
      "Plan posgrado para medicina en Colombia": 0.08,
      "Plan para Educaci√≥n para el Trabajo": 0.09,
      "Plan posgrado en el pa√≠s": 0.08,
      "Plan posgrado para fuera de Colombia": 0.08,
      "Plan segundo idioma": 0.08,
      "Plan para Bienestar fuera de Colombia": 0.08,
      "Plan de saber m√°s": 0.08
    };

const mapPeriodicidadMeses = {
  mensual: 1,
  bimestral: 2,
  trimestral: 3,
  cuatrimestral: 4,
  semestral: 6,
  anual: 12
};

function mostrarComparacion() {
  const valorRaw = document.getElementById("valorPeriodo").value.replace(/[^\d]/g, '');
  const valor = parseInt(valorRaw) || 0;
  const periodos = parseInt(document.getElementById("numPeriodos").value);
  const periodicidad = document.getElementById("periodicidad").value;
  const mesesPorPeriodo = mapPeriodicidadMeses[periodicidad] || 6;
  const contenedor = document.getElementById("resumenComparador");
  contenedor.innerHTML = "";

  const ipc = 0.052;
  const incremento = (1 + ipc) * (1 + 0.02) - 1;

  if (!valor || !periodos || !periodicidad) {
    contenedor.innerHTML = '<p style="text-align:center">Por favor completa todos los campos del formulario.</p>';
    return;
  }

  const nivel = document.getElementById("nivelFormacion").value;
  const lineas = lineasPorNivel[nivel] || [];

  if (lineas.length === 0) {
    contenedor.innerHTML = '<p style="text-align:center">Selecciona un nivel de formaci√≥n v√°lido para ver las opciones.</p>';
    return;
  }

  const totalMeses = periodos * mesesPorPeriodo;

  lineas.forEach(linea => {
    const porcentaje = condicionesLineaCredito[linea] || 0;
    const spread = spreadPorLinea[linea] || 0.08;
    const tasaEA = (1 + ipc) * (1 + spread) - 1;
    const tasaNM = Math.pow(1 + tasaEA, 1 / 12) - 1;

    const valorAjustado = Math.round(valor * Math.pow(1 + incremento, 0));
    const capitalEstudios = Math.round(valorAjustado * porcentaje);
    const cuotasEstudios = totalMeses;

    const cuota = capitalEstudios > 0
      ? Math.round((capitalEstudios * tasaNM) / (1 - Math.pow(1 + tasaNM, -mesesPorPeriodo)))
      : 0;

    const afpc = Math.round(valorAjustado * 0.02);

    let cuotasAmortizacion = 0;
    let mensajeGracia = "";

    if (linea === "Plan flexible") {
      cuotasAmortizacion = Math.round(totalMeses * 1.5);
      mensajeGracia = `<p><strong>üïí Tienes 6 meses de gracia despu√©s de terminar tus estudios.</strong></p>`;
    } else if (linea === "Plan equilibrio") {
      cuotasAmortizacion = totalMeses;
    } else if (
      linea === "Plan posgrado para medicina en Colombia" ||
      linea === "Plan posgrado en el pa√≠s"
    ) {
      cuotasAmortizacion = totalMeses * 2;
    } else if (linea === "Plan para Educaci√≥n para el Trabajo") {
      cuotasAmortizacion = Math.round(totalMeses * 1.5);
    } else if (linea === "Plan segundo idioma") {
      cuotasAmortizacion = 24;
    } else if (
      ["Plan posgrado para fuera de Colombia", "Plan para Bienestar fuera de Colombia"].includes(linea)
    ) {
      cuotasAmortizacion = 60;
    }

    const totalCuotas = cuotasEstudios + cuotasAmortizacion;

    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
      <h3>${linea}</h3>
      <p><strong>Cuota mensual en estudios:</strong> ${cuota.toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 })}</p>
      <p><strong>AFPC:</strong> ${afpc.toLocaleString('es-CO', { style: 'currency', currency: 'COP', minimumFractionDigits: 0 })}</p>
      <p><strong>Tasa de inter√©s:</strong> ${(tasaNM * 100).toFixed(2)}% NM</p>
      <p><strong>Cuotas en estudios:</strong> ${cuotasEstudios}</p>
      <p><strong>Cuotas despu√©s de estudiar:</strong> ${cuotasAmortizacion}</p>
      ${mensajeGracia}
      <button class="btn-detalle" onclick="verPlanDePagos('${linea}', ${valor}, ${periodos}, '${periodicidad}')">Ver plan de pagos </button>
    `;
    contenedor.appendChild(card);
  });
}

// ‚úÖ NUEVA FUNCI√ìN PARA REDIRIGIR Y PASAR DATOS
function verPlanDePagos(linea, valor, periodos, periodicidad) {
  const simulacion = {
    lineaCredito: linea,
    valorPeriodo: valor,
    numPeriodos: periodos,
    periodicidad: periodicidad
  };
  localStorage.setItem('datosSimulacion', JSON.stringify(simulacion));
  window.location.href = 'index_comparador.html';
}

// ‚úÖ Formatea autom√°ticamente el campo de valor con $ y puntos
function formatearCOPInput(input) {
  let valorNumerico = input.value.replace(/\D/g, '');
  if (!valorNumerico) {
    input.value = '';
    return;
  }

  let valor = parseInt(valorNumerico);
  input.value = valor.toLocaleString('es-CO', {
    style: 'currency',
    currency: 'COP',
    minimumFractionDigits: 0
  });
}

  </script>
</body>
</html>